CREATE TABLE Journals (
	ISSN VARCHAR(20) PRIMARY KEY,
	name VARCHAR(100) UNIQUE NOT NULL
	
);

CREATE TABLE Volumes (
	volumeNum INT,
	ISSN VARCHAR(20),
	publicationYear SMALLINT UNIQUE,
	PRIMARY KEY (volumeNum, ISSN),
	FOREIGN KEY (ISSN) REFERENCES Journals(ISSN)
		ON DELETE CASCADE
);

CREATE TABLE Editions (
	editionID INT PRIMARY KEY AUTO_INCREMENT,
	editionNum TINYINT,
	publicationMonth TINYINT,
	volumeNum INT,
	isPublic BOOLEAN DEFAULT FALSE,
	ISSN VARCHAR(20),
	FOREIGN KEY (volumeNum, ISSN) REFERENCES Volumes(volumeNum, ISSN)
		ON DELETE CASCADE,
		
	CHECK (editionNum < 7)
);

CREATE TABLE Users (
	email VARCHAR(80) PRIMARY KEY,
	title VARCHAR(5), 
	forenames VARCHAR(150),
	surname VARCHAR(120),
	university VARCHAR(100),
	password VARCHAR(200) NOT NULL
);

CREATE TABLE JournalEditors (
	ISSN VARCHAR(20),
	email VARCHAR(80),
	isChief BOOL NOT NULL DEFAULT FALSE,
	PRIMARY KEY(ISSN, email),
	FOREIGN KEY(email) REFERENCES Users(email)
		ON DELETE NO ACTION,
	FOREIGN KEY(ISSN) REFERENCES Journals(ISSN)
		ON DELETE CASCADE
);

CREATE TABLE Articles (
	articleID INT PRIMARY KEY AUTO_INCREMENT,
	title VARCHAR(1000) NOT NULL,
	abstract VARCHAR(2000) NOT NULL,
	content VARCHAR(400) NOT NULL,
	isFinal BOOL DEFAULT FALSE,
	isAccepted BOOL DEFAULT FALSE,
	ISSN VARCHAR(20),
	
	FOREIGN KEY(ISSN) REFERENCES Journals(ISSN)
		ON DELETE CASCADE
);

CREATE TABLE Authorships (
	email VARCHAR(80),
	articleID INT,
	isMain BOOL NOT NULL DEFAULT FALSE,
	PRIMARY KEY(email, articleID),
	FOREIGN KEY(email) REFERENCES Users(email)
		ON DELETE NO ACTION,
	FOREIGN KEY(articleID) REFERENCES Articles(articleID)
		ON DELETE CASCADE
);

CREATE TABLE EditionArticles (
	editionArticleID INT PRIMARY KEY AUTO_INCREMENT,
	articleID INT NOT NULL,
	editionID INT NOT NULL,
	startingPage INT UNSIGNED,
	endingPage INT UNSIGNED,
	FOREIGN KEY(articleID) REFERENCES Articles(articleID)
		ON DELETE CASCADE,
	FOREIGN KEY(editionID) REFERENCES Editions(editionID)
		ON DELETE CASCADE
);

CREATE TABLE Reviews (
	reviewID INT PRIMARY KEY AUTO_INCREMENT,
	
	summary VARCHAR(2000),
	verdict VARCHAR(25),
	isFinal BOOL DEFAULT FALSE,
	
	submissionID INT NOT NULL,
	articleOfReviewerID INT,
	reviewerEmail VARCHAR(80) NOT NULL,
	hasResponse BOOL DEFAULT FALSE,
	
	FOREIGN KEY(submissionID) REFERENCES Articles(articleID)
		ON DELETE CASCADE,
	FOREIGN KEY(reviewerEmail) REFERENCES Users(email)
		ON DELETE NO ACTION,
	FOREIGN KEY(articleOfReviewerID) REFERENCES Articles(articleID)
		ON DELETE SET NULL
);

CREATE TABLE Critiques (
	critiqueID INT PRIMARY KEY AUTO_INCREMENT,
	reviewID INT NOT NULL,
	description VARCHAR(250) NOT NULL,
	reply VARCHAR(250) DEFAULT NULL,
	FOREIGN KEY(reviewID) REFERENCES Reviews(reviewID)
		ON DELETE CASCADE
);

ALTER TABLE `Editions` ADD UNIQUE `unique_index`(`editionNum`, `volumeNum`, `ISSN`);

